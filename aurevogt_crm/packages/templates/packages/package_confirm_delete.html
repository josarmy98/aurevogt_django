

{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% trans 'Eliminar paquete' %}{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto">
  <div class="bg-white shadow rounded-md p-6 border border-red-200">
    <h1 class="text-2xl font-bold text-red-700 mb-4">{% trans 'Confirmar eliminación de paquete' %}</h1>

    {# Determina el objeto disponible: 'object' (DeleteView) o 'package' (vista propia) #}
    {% with pkg=object|default:package %}
      {% if not pkg %}
        <div class="p-4 bg-yellow-50 border border-yellow-200 rounded text-yellow-800">
          {% trans 'No se encontró el paquete a eliminar.' %}
        </div>
      {% else %}
        <div class="p-4 bg-red-50 border border-red-200 rounded text-red-900 mb-6">
          <p class="font-medium">
            {% trans 'Esta acción es permanente. No podrás deshacerla.' %}
          </p>
          <ul class="mt-2 text-sm list-disc list-inside">
            <li><span class="font-semibold">{% trans 'Tracking:' %}</span> {{ pkg.tracking_number }}</li>
            <li><span class="font-semibold">{% trans 'Estado:' %}</span> {{ pkg.get_status_display|default:pkg.status }}</li>
            <li><span class="font-semibold">{% trans 'Destinatario:' %}</span> {{ pkg.recipient_name }}</li>
            <li>
              <span class="font-semibold">{% trans 'Dirección:' %}</span>
              {{ pkg.addr_street }}{% if pkg.addr_city %}, {{ pkg.addr_city }}{% endif %}{% if pkg.addr_state %}, {{ pkg.addr_state }}{% endif %}{% if pkg.addr_zip %} {{ pkg.addr_zip }}{% endif %}
            </li>
            {% if pkg.assigned_driver %}
              <li><span class="font-semibold">{% trans 'Conductor asignado:' %}</span> {{ pkg.assigned_driver }}</li>
            {% endif %}
            {% if pkg.created_at %}
              <li><span class="font-semibold">{% trans 'Creado:' %}</span> {{ pkg.created_at|date:'Y-m-d H:i' }}</li>
            {% endif %}
          </ul>
        </div>

        {% if perms.packages.delete_package %}
          <form method="post" action="">
            {% csrf_token %}
            {# Si tu DeleteView requiere confirmación adicional, puedes incluir un input hidden #}
            <div class="flex items-center gap-3">
              <button type="submit" class="px-4 py-2 rounded bg-red-600 hover:bg-red-700 text-white font-medium">
                {% trans 'Sí, eliminar definitivamente' %}
              </button>

              {# Botón cancelar: intenta regresar a where=next, a la lista de paquetes o a la página previa #}
              {% if request.GET.next %}
                <a href="{{ request.GET.next }}" class="px-4 py-2 rounded border border-gray-300 hover:bg-gray-50 text-gray-700">
                  {% trans 'Cancelar' %}
                </a>
              {% else %}
                {# Intentar URL nombrada del módulo packages; si no existe, caer al admin #}
                {% url 'packages:list' as pk_list_url %}
                {% if pk_list_url %}
                  <a href="{{ pk_list_url }}" class="px-4 py-2 rounded border border-gray-300 hover:bg-gray-50 text-gray-700">
                    {% trans 'Cancelar' %}
                  </a>
                {% else %}
                  <a href="{% url 'admin:packages_package_changelist' %}" class="px-4 py-2 rounded border border-gray-300 hover:bg-gray-50 text-gray-700">
                    {% trans 'Cancelar' %}
                  </a>
                {% endif %}
              {% endif %}
            </div>
          </form>
        {% else %}
          <div class="p-4 bg-yellow-50 border border-yellow-200 rounded text-yellow-800">
            {% trans 'No tienes permisos para eliminar paquetes. Contacta a un administrador.' %}
          </div>
          <div class="mt-4">
            {% url 'packages:list' as pk_list_url %}
            {% if pk_list_url %}
              <a href="{{ pk_list_url }}" class="px-4 py-2 rounded border border-gray-300 hover:bg-gray-50 text-gray-700">
                {% trans 'Volver' %}
              </a>
            {% else %}
              <a href="{% url 'admin:packages_package_changelist' %}" class="px-4 py-2 rounded border border-gray-300 hover:bg-gray-50 text-gray-700">
                {% trans 'Volver' %}
              </a>
            {% endif %}
          </div>
        {% endif %}
      {% endif %}
    {% endwith %}
  </div>

  {# Información adicional/ayuda #}
  <details class="mt-6 bg-gray-50 border border-gray-200 rounded p-4">
    <summary class="cursor-pointer font-medium text-gray-700">{% trans '¿Qué incluye eliminar un paquete?' %}</summary>
    <ul class="text-sm mt-2 list-disc list-inside text-gray-600">
      <li>{% trans 'Se borrará el registro del paquete.' %}</li>
      <li>{% trans 'Podría dejar huérfanos eventos o intentos de entrega si no hay ON DELETE CASCADE (revisa tu modelo).' %}</li>
      <li>{% trans 'Considera marcar como "cancelled" en vez de borrar, para mantener trazabilidad.' %}</li>
    </ul>
  </details>
</div>
{% endblock %}